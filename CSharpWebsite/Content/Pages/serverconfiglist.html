<!DOCTYPE html>
<html>
    <head>
        <link rel="icon" type="image/x-icon" href="Images/favicon.ico">
        <meta charset="utf-8" />
        <title>Ubunifu's Website - Server Config List</title>
        <style>
            .TopBar {
                position: absolute;
                width: 100vw;
                height: 75px;
                background-color: black;
                left: 0;
                top: 0;
                right: 0;
                margin-top: 0;
                margin-left: 0;
                z-index: 99
            }

            .TopBarElement {
                position: absolute;
                z-index: 101;
                top: 25px;
                right: 25px;
                user-select: none;
            }

            .TopBarButton {
                position: absolute;
                z-index: 101;
                top: 30px;
                user-select: none;
                cursor: pointer;
            }

            .alignCenter {
                display: flex;
                justify-content: center;
                align-items: center;
                text-align: center;
                min-height: 100vh;
            }

            div.container {
                display: inline-block;
                min-width: 10vw;
                max-width: 90vw
            }

            p {
                text-align: center;
            }

            .alignContentCenter {
                display: flex;
                justify-content: center;
                align-items: center;
            }
            .inputTab {
                border: double;
                border-color: red;
                border-spacing: 20px 100px;
                border-radius: 6px 8px
            }

            .profileElement {
                font-size: 30px;
                font: bold;
            }

            .show {
                opacity: 1;
                animation: fadeIn 0.3s linear;
            }

            .hide {
                opacity: 0;
                animation: fadeOut 0.3s linear;
            }

            @keyframes fadeIn {
                0% {
                    opacity: 0
                }

                100% {
                    opacity: 1
                }
            }

            @keyframes fadeOut {
                0% {
                    opacity: 1
                }

                100% {
                    opacity: 0
                }
            }
        </style>
    </head>
    <body style="background-color:rgb(50,50,50); color:white">
        <div class="TopBar">
        </div>
        <fieldset class="TopBarElement" style="border:solid;border-color:lime;border-radius:7px;top:10px;font:bold;font-size:15px;user-select:none;cursor:pointer" onclick="ReturnToList(this)">Back To Homepage</fieldset>
        <script>
            function SendHTTPGet(connection) {
                return new Promise((resolve, reject) => {
                    var res = fetch(connection).then(function (response) {
                        return response.json();
                    }).then(function (data) {
                        resolve(data.response);
                    }).catch(function (err) {
                        reject(`Fetch Error: ${err}`)
                    });
                })
            }
            function SendHTTPPost(connection, content) {
                return new Promise((resolve, reject) => {
                    // Create a new XMLHttpRequest object
                    var xhr = new XMLHttpRequest();

                    // Define the request method, URL, and async flag
                    xhr.open("POST", connection, true);

                    // Set the request header (optional)
                    xhr.setRequestHeader("Content-Type", "application/json");

                    // Define the callback function when the request is complete
                    xhr.onreadystatechange = function () {
                        if (xhr.readyState === XMLHttpRequest.DONE) {
                            if (xhr.status === 200) {
                                document.open();
                                document.write(xhr.responseText);
                                document.close();
                                resolve(xhr.responseText);
                            } else {
                                reject("Error: " + xhr.status);
                            }
                        }
                    };

                    xhr.send(content);
                });
            }
            function ReturnToList(element) {
                SendHTTPPost("/", null).then(() => { }).catch(() => { })
            }
            window.onload = async () => {
                try {
                    var sess = JSON.parse(sessionStorage.getItem("SessionDetails"))
                    var data = await SendHTTPGet(`/requestServers?email=${sess.email}&id=${sess.sessionId}`)
                    var json = JSON.parse(data)
                    var element = document.getElementById("servertemplate")
                    var s = 15
                    console.log(json)
                    for (var i = 0; i < json.length; i++) {
                        var clone = element.cloneNode(true)
                        clone.children[0].src = json[i].server.serverimgURL
                        clone.children[2].innerText = json[i].Name
                        clone.children[2].id = json[i].serverID
                        clone.style.left = s + "vw"
                        s=s+15
                        clone.removeAttribute("hidden")
                        document.getElementById("serverHolder").appendChild(clone)
                    }
                } catch { }
            }
            async function loadServerConfig(element) {
                SendHTTPPost(`/loadServerConfig?id=${element.children[2].id}`, null)
                    .then(() => {
                        sessionStorage.setItem("serverTarget", element.children[2].id)
                    })
            }
        </script>
        <fieldset id="servertemplate" hidden="" style="text-align:center;cursor:pointer;left:35vw;top:150px;border:solid;border-color:black;user-select:none;background-color:gray;width:auto;min-width:100px;min-height:100px;border-radius:6px;position:absolute;z-index:100" onclick="loadServerConfig(this)">
            <img src="Images/unknownprofilepic.png" style="margin-left:15px" />
            <br />
            <label>Unknown Server</label>
        </fieldset>
        <div id="serverHolder">

        </div>
    </body>
</html>